<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŠ è½½ä¸­... - RETOUR</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>

  <style>
    /* æ–‡ç« é¡µä¸“ç”¨æ ·å¼ */
    body {
      background-color: #fff;
      overflow-y: scroll;
    }

    .article-container {
      max-width: 800px;
      margin: 120px auto 100px;
      padding: 0 20px;
    }

    /* è¿™æ˜¯ Markdown è½¬æ¢åçš„ HTML çš„æ ·å¼ */
    #markdown-content {
      line-height: 1.8;
      color: #333;
      font-family: -apple-system, sans-serif;
    }

    /* é’ˆå¯¹ Markdown å…ƒç´ çš„æ ·å¼ç¾åŒ– */
    #markdown-content h1 {
      font-family: 'Montserrat';
      font-weight: 900;
      font-size: 2.5rem;
      margin-bottom: 20px;
    }

    #markdown-content h2 {
      font-weight: 700;
      margin-top: 40px;
      margin-bottom: 15px;
    }

    #markdown-content p {
      margin-bottom: 20px;
      font-size: 1.1rem;
    }

    #markdown-content blockquote {
      border-left: 4px solid #000;
      padding-left: 20px;
      color: #666;
      font-style: italic;
    }

    #markdown-content img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 20px 0;
    }

    .back-link {
      display: inline-block;
      margin-top: 50px;
      color: #000;
      font-weight: 700;
      text-decoration: none;
      border-bottom: 2px solid #000;
    }
  </style>
</head>

<body>

  <header class="header-bar" style="position: absolute;">
    <a href="../index.html"><img src="../assets/images/profile.png" alt="Icon" class="top-icon"
        style="opacity: 1; transform: scale(1);"></a>
  </header>

  <article class="article-container">
    <div id="markdown-content">
      æ­£åœ¨åŠ è½½æ–‡ç« ...
    </div>

    <a href="blog.html" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
  </article>

  <script>
    // === æ ¸å¿ƒé€»è¾‘ï¼šè¯»å– Markdown å¹¶æ˜¾ç¤º ===
    document.addEventListener('DOMContentLoaded', () => {

      // --- è¾…åŠ©å‡½æ•°ï¼šå°† Hex é¢œè‰²è½¬ä¸º RGBA (ç”¨äºç”ŸæˆåŠé€æ˜èƒŒæ™¯) ---
      function hexToRgba(hex, alpha) {
        let c;
        if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {
          c = hex.substring(1).split('');
          if (c.length == 3) {
            c = [c[0], c[0], c[1], c[1], c[2], c[2]];
          }
          c = '0x' + c.join('');
          return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ',' + alpha + ')';
        }
        return hex; // å¦‚æœä¸æ˜¯ Hexï¼ŒåŸæ ·è¿”å›
      }

      // 1. è·å– URL ä¸­çš„å‚æ•°ï¼Œä¾‹å¦‚: article.html?post=my-first-post
      const urlParams = new URLSearchParams(window.location.search);
      const postName = urlParams.get('post'); // æ‹¿åˆ° "my-first-post"
      const contentDiv = document.getElementById('markdown-content');

      if (!postName) {
        document.getElementById('markdown-content').innerHTML = "<h1>âŒ é”™è¯¯ï¼šæœªæŒ‡å®šæ–‡ç« æ–‡ä»¶ã€‚</h1>";
        return;
      }

      // 2. æ‹¼æ¥ Markdown æ–‡ä»¶çš„è·¯å¾„
      // æ³¨æ„ï¼šå› ä¸º article.html åœ¨ pages/ é‡Œï¼Œæ‰€ä»¥è¦è¿”å›ä¸Šä¸€çº§æ‰¾ assets
      const mdFile = `../assets/posts/${postName}.md`;


      // 3. ä½¿ç”¨ fetch å»è¯»å–é‚£ä¸ªæ–‡ä»¶
      fetch(mdFile)
        .then(response => {
          if (!response.ok) throw new Error("æ–‡ç« æœªæ‰¾åˆ°");
          return response.text(); // æŠŠæ–‡ä»¶å†…å®¹å½“åšçº¯æ–‡æœ¬è¯»å‡ºæ¥
        })
        // ... ä¹‹å‰çš„ fetch ä»£ç  ...
        // ... å‰é¢çš„ marked.parse å’Œ innerHTML é€»è¾‘ ...

        .then(markdownText => {

          contentDiv.innerHTML = marked.parse(markdownText);

          // ====================================================
          // ğŸ› ï¸ ä¿®å¤ 1: å¤„ç† Mermaid å›¾è¡¨ (é˜²æ­¢ Syntax Error)
          // ====================================================
          contentDiv.querySelectorAll('pre code.language-mermaid').forEach(code => {
            const pre = code.parentElement;
            const div = document.createElement('div');
            div.className = 'mermaid';
            div.textContent = code.textContent; // è‡ªåŠ¨ä¿®å¤è½¬ä¹‰å­—ç¬¦
            pre.replaceWith(div);
          });

          // ====================================================
          // ğŸ¨ 2. æç¤ºå—ï¼šæ”¯æŒ Markdown å†…è”è‡ªå®šä¹‰é¢œè‰²
          // è¯­æ³•ï¼š > [!TYPE|#COLOR|ICON] Title
          // ====================================================
          contentDiv.querySelectorAll('blockquote').forEach(bq => {
            const firstP = bq.querySelector('p');
            if (!firstP) return;

            const fullText = firstP.textContent;

            // æ­£åˆ™è§£é‡Šï¼š
            // Group 1: ç±»å‹ (å¦‚ NOTE)
            // Group 2 (å¯é€‰): é¢œè‰² (å¦‚ #ff0000)
            // Group 3 (å¯é€‰): å›¾æ ‡ (å¦‚ ğŸš€)
            // Group 4: æ ‡é¢˜å†…å®¹
            const match = fullText.match(/^\[!([a-zA-Z0-9_-]+)(?:\|(#[0-9a-fA-F]{3,6}))?(?:\|(.+?))?\]\s*(.*)/);

            if (match) {
              const type = match[1].toLowerCase();
              const customColor = match[2]; // è·å–è‡ªå®šä¹‰é¢œè‰²
              const customIcon = match[3];  // è·å–è‡ªå®šä¹‰å›¾æ ‡
              const title = match[4] || type.toUpperCase();

              // åˆ›å»ºå®¹å™¨
              const adDiv = document.createElement('div');
              adDiv.className = `admonition admonition-${type}`;

              // --- ğŸ¨ æ ¸å¿ƒï¼šå¦‚æœæœ‰è‡ªå®šä¹‰é¢œè‰²ï¼Œç›´æ¥ä¸Šè‰² ---
              if (customColor) {
                // å·¦è¾¹æ¡†é¢œè‰² = åŸè‰²
                adDiv.style.borderLeftColor = customColor;
                // èƒŒæ™¯è‰² = ææ·¡çš„åŸè‰² (5% ä¸é€æ˜åº¦)
                adDiv.style.backgroundColor = hexToRgba(customColor, 0.05);
              }

              // æ ‡é¢˜æ 
              const titleDiv = document.createElement('div');
              titleDiv.className = 'admonition-title';

              // --- ğŸ¨ æ ¸å¿ƒï¼šå¦‚æœæœ‰è‡ªå®šä¹‰é¢œè‰²ï¼Œæ ‡é¢˜æ ä¹Ÿä¸Šè‰² ---
              if (customColor) {
                titleDiv.style.color = customColor; // æ–‡å­—é¢œè‰²
                titleDiv.style.backgroundColor = hexToRgba(customColor, 0.15); // èƒŒæ™¯æµ…è‰²
              }

              // å›¾æ ‡é€»è¾‘ï¼šä¼˜å…ˆç”¨ Markdown é‡Œå†™çš„å›¾æ ‡ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç•™ç©º (CSS ä¼šå¤„ç†é»˜è®¤å›¾æ ‡)
              let iconHtml = '<span class="admonition-icon"></span>';
              if (customIcon) {
                // å¦‚æœç”¨æˆ·å†™äº†å›¾æ ‡ï¼Œç›´æ¥è¦†ç›–
                iconHtml = `<span class="admonition-icon" style="margin-right:8px;">${customIcon}</span>`;
                // é¡ºä¾¿æŠŠ CSS é»˜è®¤çš„ä¼ªå…ƒç´ å›¾æ ‡éšè—æ‰
                const style = document.createElement('style');
                style.innerHTML = `.admonition-${type} .admonition-icon::before { content: none !important; }`;
                adDiv.appendChild(style);
              }

              titleDiv.innerHTML = `${iconHtml}${title}`;

              // å†…å®¹å¤„ç† (å»é‡)
              const contentDiv = document.createElement('div');
              contentDiv.className = 'admonition-content';
              contentDiv.innerHTML = bq.innerHTML;

              const cleanP = contentDiv.querySelector('p');
              if (cleanP) {
                // ç§»é™¤æ ‡è®°æ–‡å­—
                cleanP.textContent = cleanP.textContent.replace(/^\[!.*?\]\s*.*(\r\n|\n|\r)?/, '');
                if (!cleanP.textContent.trim()) cleanP.remove();
              }

              adDiv.appendChild(titleDiv);
              adDiv.appendChild(contentDiv);
              bq.replaceWith(adDiv);
            }
          });
          // ====================================================
          // ğŸ¦“ ä¿®å¤ 3: æ™®é€šä»£ç å—ç¾åŒ– (é¡¶éƒ¨æ ‡é¢˜ + æ–‘é©¬çº¹æ”¯æŒ)
          // ====================================================
          contentDiv.querySelectorAll('pre code').forEach(code => {
            // æ­¤æ—¶ Mermaid å·²ç»è¢«ä¸Šé¢å¤„ç†æ‰äº†ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯æ™®é€šä»£ç 
            const pre = code.parentElement;

            // æå–è¯­è¨€åç§° (å¦‚ "JAVA")
            let lang = "TEXT";
            if (code.className && code.className.includes('language-')) {
              lang = code.className.replace('language-', '').toUpperCase();
            }
            pre.setAttribute('data-language', lang);

            // ç¡®ä¿ Prism é«˜äº®
            if (code.className) pre.className = code.className;
          });

          // ===============================================
          // ğŸ“‹ å¤åˆ¶åŠŸèƒ½å¢å¼ºè„šæœ¬ (Copy Logic)
          // ===============================================

          // --- 1. å¤„ç†ä»£ç å— (Block Code) ---
          const pres = contentDiv.querySelectorAll('pre');
          pres.forEach(pre => {
            // è·³è¿‡ Mermaid å›¾è¡¨
            if (pre.classList.contains('mermaid') || pre.parentElement.classList.contains('mermaid')) return;

            // åˆ›å»ºå¤åˆ¶æŒ‰é’®å®¹å™¨
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-code-btn';
            copyBtn.innerHTML = 'ğŸ“‹'; // ä½ ä¹Ÿå¯ä»¥æ¢æˆ SVG å›¾æ ‡
            copyBtn.setAttribute('aria-label', 'å¤åˆ¶ä»£ç ');

            // ç»‘å®šç‚¹å‡»å¤åˆ¶äº‹ä»¶
            copyBtn.addEventListener('click', () => {
              // è·å–ä»£ç æ–‡æœ¬ (å»æ‰å¤šä½™çš„æ¢è¡Œ)
              const code = pre.querySelector('code').innerText;

              navigator.clipboard.writeText(code).then(() => {
                // å¤åˆ¶æˆåŠŸçš„åé¦ˆ
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = 'âœ…'; // å˜æˆå¯¹å‹¾
                copyBtn.classList.add('copied');

                // 2ç§’åå˜å›åŸæ ·
                setTimeout(() => {
                  copyBtn.innerHTML = originalText;
                  copyBtn.classList.remove('copied');
                }, 2000);
              }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                copyBtn.innerHTML = 'âŒ';
              });
            });

            // å°†æŒ‰é’®æ·»åŠ åˆ° pre ä¸­
            pre.appendChild(copyBtn);
          });

          // --- 2. å¤„ç†è¡Œå†…ä»£ç  (Inline Code) ---
          const inlineCodes = contentDiv.querySelectorAll(':not(pre) > code');
          inlineCodes.forEach(code => {
            // åªæœ‰å½“ä»£ç å†…å®¹ä¸ä¸ºç©ºæ—¶æ‰ç»‘å®š
            if (!code.innerText.trim()) return;

            code.style.cursor = 'copy'; // é¼ æ ‡å˜æˆå¤åˆ¶æ‰‹åŠ¿
            code.title = 'ç‚¹å‡»å¤åˆ¶';   // é¼ æ ‡æ‚¬åœæç¤º

            code.addEventListener('click', (e) => {
              const text = code.innerText;
              navigator.clipboard.writeText(text).then(() => {
                // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„â€œå·²å¤åˆ¶â€æç¤ºæ¡†è·Ÿéšé¼ æ ‡
                showTooltip(e.pageX, e.pageY, 'å·²å¤åˆ¶!');
              });
            });
          });

          // --- è¾…åŠ©å‡½æ•°ï¼šæ˜¾ç¤ºè¡Œå†…ä»£ç çš„æç¤ºæ¡† ---
          function showTooltip(x, y, msg) {
            const tooltip = document.createElement('div');
            tooltip.className = 'copy-tooltip';
            tooltip.innerText = msg;
            document.body.appendChild(tooltip);

            // å®šä½
            tooltip.style.left = x + 'px';
            tooltip.style.top = (y - 30) + 'px';

            // åŠ¨ç”»æ¶ˆå¤±
            setTimeout(() => {
              tooltip.style.opacity = '0';
              tooltip.style.transform = 'translateY(-10px)';
            }, 1000);
            setTimeout(() => tooltip.remove(), 1500);
          }


          // ===============================================
          // ğŸš€ å¯åŠ¨æ¸²æŸ“
          // ===============================================

          // 1. æ¸²æŸ“ Mermaid (æ³¨æ„ï¼šç°åœ¨å®ƒå¯»æ‰¾çš„æ˜¯ .mermaid ç±»)
          mermaid.init(undefined, document.querySelectorAll('.mermaid'));
          // ====================================================
          // ğŸš€ å¯åŠ¨æ¸²æŸ“
          // ====================================================
          if (typeof mermaid !== 'undefined') mermaid.init(undefined, document.querySelectorAll('.mermaid'));
          if (typeof Prism !== 'undefined') Prism.highlightAllUnder(contentDiv);

          document.title = (markdownText.split('\n')[0].replace('# ', '') || 'æ–‡ç« ') + " - RETOUR";
        })
        // ... catch ...
        .catch(error => {
          document.getElementById('markdown-content').innerHTML = `<h1>âŒ åŠ è½½å¤±è´¥</h1><p>è¯·ç¡®ä¿æ‚¨æ˜¯é€šè¿‡æœ¬åœ°æœåŠ¡å™¨ (Live Server) è®¿é—®çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥åŒå‡» HTML æ–‡ä»¶ã€‚<br>é”™è¯¯ä¿¡æ¯: ${error.message}</p>`;
        });
    });


  </script>
</body>

</html>